<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Chart</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/stock.js"></script>
</head>
<body>
    <div id="stock-chart" style="height: 400px; min-width: 310px"></div>

    <script type="text/javascript">
        // 從模板上下文中獲取變數
        var stockSymbol = "{{ stock_symbol }}";
        var startDate = "{{ start_date }}";
        var endDate = "{{ end_date }}";
        var windowSize = "{{ window_size }}";

        var data = {
            'stock_symbol': stockSymbol,
            'start_date': startDate,
            'end_date': endDate,
            'window_size': windowSize
        };

        // 使用 AJAX 來抓取後端 API 的數據
        fetch(`/api/stock-data/?symbol=${stockSymbol}&start_date=${startDate}&end_date=${endDate}&window_size=${windowSize}`,{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}' // 這裡要傳遞 CSRF Token
            },
            body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                Highcharts.stockChart('stock-chart', {
                    rangeSelector: {
                        selected: 1
                    },
                    title: {
                        text: stockSymbol + ' Stock Price'
                    },
                    series: [{
                        name: stockSymbol,
                        data: data.stock_data,
                        tooltip: {
                            valueDecimals: 2
                        }
                    }]
                });
            });
    </script>
</body>
</html>